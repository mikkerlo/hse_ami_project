# Геррит работа-поток

Я понял что я убил кучу сил в поднятие геррита. Но не написал как правильно его использовать, и здесь будет истинно верная инструкция как с ним работать.
Дальнейшее повествование будет посвящено git-review как способу работы с герритом, вы можете юзать его как угодно но не ломая основные концепты описанные ниже

## Концепции работы с Герритом
Есть набор вещей из-за которых геррит сильно отличается от привычного git-flow, и здесь я просто опишу какой-то минимум вещей которые стоит соблюсти. В последствии список может дополниться

1. Один коммит -- одно ревью. Если хотите менять ревью делайте amend
2. Коммит должен быть довольно малым, содержать в себе минимальное логическое изменение. Если коммит не может быть понятен без контекста других коммитов, стоит объеденить их в топик
3. Коммит не должен ломать тесты

## Настройка

Итак для начала вам надо поставить свежий питон с чем я надеюсь все справились, далее
```bash
pip install git-review
```

Склоньте проект с хуками в папку. Далее там создайте файл __.gitreview__ следующего содержания:
```
[gerrit]
host=gerrit.mikkerlo.ru
port=29418
project=mikkerlo/hse_ami_project
defaultbranch=your_default_branch
user=your_username
```

Вместо __your_default_branch__ стоит написать бранчу в которую вы комитите больше всего, вместо __your_user_name__ стоит написать имя юзера в геррите.
Попробуйте написать ```git review -s``` чтобы проверить что всё правильно настроилось.

## Кейсы использования

### Casual way
Итак вы находитесь в свежей ветке и хотите написать изменение, вы делаете следующее:
1. Создаёте новую ветку со своим изменением
2. В ней делаете __один__ коммит
3. Пишите ```git review branch``` где **branch** это то куда вы хотите применить изменение, можно не писать если это ваш дефолт.
4. Вы победили, можете удалить эту ветку после сабмита(ну или сейчас). Пушить на сервер её не стоит

### Изменение
Итак вы хотите сделать изменение в ревью, путь следующий:
1. ```git review -d change``` чтобы склонить change к себе и перейти в него
2. Отредактируйте его
3. Закомитьте с ```--amend```
4. Напишите ```git review branch``` описание работы есть выше


### Чеин ревью
Тут всё просто, отведите новую ветку от ветки с чейнджом(как её получать есть выше) и работайте как с обычным ревью. Важно что при чеине стоит указывать ту же ветку у команды ```git review``` что и у предка

## Полезные флаги у команды ```git review```
1. Флаги ```-W``` и ```-w```. Первый говорит что этот коммит готов к мержу, второй говорит что идет __work in progress__ и коммит комитить нельзя
2. Флаг ```-t``` позволяет указать топик у ревью
3. Флаг ```-l``` показывает все открытые ревью
4. Флаг ```-f``` удаляет текущую бранчу если успешно отправилось в геррит
5. Флаг ```--reviewers``` позволяет прямо в консоли указать ревьюверов по их почтам
6. Флаг ```-D``` сказать что это ревью это драфт
7. Флаг ```-u``` форс обновление с сервера геррита

